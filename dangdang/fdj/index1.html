<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>放大镜</title>
	<style>
		*{
			margin:0;
			padding:0;
		}
		.glass img{
			display: block;
			border:0;
			width: 100%;
			height: 100%;
		}
		.glass{
			width: 300px;
			height: 300px;
			position: relative;
			margin:50px;
		}
		.bg{
			background: url("img/2.jpg") no-repeat center;
			background-size: 100% 100%;
		}
	</style>
</head>
<body>
	<div class="glass">
		<img src="img/1.jpg" alt="">
	</div>
	<div class="glass bg"></div>

</body>
<script>
//获取需要进行放大镜效果的元素们
	var gla = document.querySelectorAll('.glass');
	console.log(gla) //cs ww
	//声明放大倍数
	var scale = 5;
	// 键盘事件
	document.onkeydown = function(evt){
		// console.log(evt.key)
		if(evt.key=='ArrowDown'||evt.key=='-'){
			scale-=1;
			if(scale<1){
				scale=1
			}
		}else if(evt.key=='ArrowUp'||evt.key=='='){
			scale+=1;
			if(scale>5){
				scale=5
			}
		}
	}
	//声明一个变量来存放大的图片的路径作为放大镜的背景图
	var urls = '';
	//对需要有放大镜效果的元素们进行遍历
	for(var i=0;i<gla.length;i++){
		//创建右侧放大区域的div
		var crea = document.createElement('div');
		//创建鼠标滑进去的小方块
		var spans = document.createElement('span');
		gla[i].onmousemove = function(e){
			var e = event||window.event;
			//获取当前元素里面的插入图片
			var imgages = this.getElementsByTagName('img')[0];
			// 获取元素非行间样式   兼容
			var finalStyle = this.currentStyle?this.currentStyle:getComputedStyle(this,false);
			// console.log(finalStyle)

			// 进行判断是插入图片还是背景图
			if(imgages == undefined){
				//代表插入背景图
				urls = finalStyle.backgroundImage;
				console.log(urls)
			}else{
				// 代表插入图片
				urls = 'url("'+imgages.src+'")'
				console.log(urls)
			}

			// 对右侧放大区域进行修饰
			crea.style.display = 'block';
			crea.style.position = 'absolute';//定位  根据.glass
			crea.style.background = urls;//将背景图添加上
			//设该元素的宽高
			crea.style.width = this.offsetWidth + 'px';
			crea.style.height = this.offsetHeight+"px";
			//设背景图大小   因为我们要放大三倍  所以背景图也应该放大三倍
			//
			var widths = '';
			widths+= this.offsetWidth*scale+'px ';
			widths += this.offsetHeight*scale+'px';
			crea.style.backgroundSize = widths;
			crea.style.backgroundRepeat = 'no-repeat';
			//他是相对左边进行定位  
			crea.style.left  = this.offsetWidth + 10 +'px';
			crea.style.top = '0px';
			this.appendChild(crea)
			
			//小方块
			spans.style.display = 'block';
			spans.style.position = 'absolute';
			spans.style.background = 'rgba(0,0,0,0.5)';
			//小方块的宽高
			spans.style.width = this.offsetWidth/scale + 'px';
			spans.style.height = this.offsetHeight/scale+'px';
			//spans的left值和top值   是跟随移动而变化的
			//获取滚动距离
			var scrollx = document.body.scrollLeft||document.documentElement.scrollLeft;
			var scrollY = document.body.scrollTop||document.documentElement.scrollTop;


			var lefts = e.clientX-this.offsetLeft-((this.offsetWidth/scale)/2) + scrollx+'px';
			var tops = e.clientY-this.offsetTop-((this.offsetHeight/scale)/2) + scrollY+'px';


			spans.style.top = tops;
			spans.style.left = lefts;
			if(parseInt(spans.style.left)<=0){
				spans.style.left = 0;
			}else if(parseInt(spans.style.left) >= this.offsetWidth-spans.offsetWidth){
				spans.style.left = this.offsetWidth-spans.offsetWidth+'px';
			}
			if(parseInt(spans.style.top)<=0){
				spans.style.top = 0;
			}else if(parseInt(spans.style.top)>= this.offsetHeight-spans.offsetHeight){
				spans.style.top = this.offsetHeight - spans.offsetHeight + 'px';
			}
			//放大镜的背景跟随span的移动而移动位置
			var bpLeft = -spans.offsetLeft*scale + 'px ';
			var bpTop = -spans.offsetTop*scale+'px';
			crea.style.backgroundPosition = bpLeft+bpTop
			this.appendChild(spans)

			//担心小方块=会滑入右侧f放大镜部分
			crea.onmousemove = function(){
				this.style.visibility = 'hidden';
			}
			crea.onmouseout = function(){
				this.style.visibility = 'visible';
			}

		}
		gla[i].onmouseout = function(){
			crea.style.display = 'none';
			spans.style.display = 'none';
		}
	}
</script>
</html>